<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>英文生成ドリル プロトタイプ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- PWA設定ファイルの読み込み -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">

    <style>
        body { touch-action: manipulation; }
        .btn:focus { outline: none; ring: 3px; ring-offset: 2px; }
        .btn { transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out; }
        .btn:active { transform: scale(0.98); }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen font-sans text-gray-800">

    <div class="w-full max-w-lg mx-auto p-4 flex flex-col h-screen">
        <!-- ヘッダー -->
        <header class="text-center py-4">
            <h1 class="text-2xl font-bold">英文生成ドリル</h1>
        </header>

        <!-- メインの練習エリア -->
        <main class="flex-grow flex flex-col justify-center">
            <!-- 問題表示エリア -->
            <div id="quiz-area" class="bg-white rounded-xl shadow-lg p-6 min-h-[150px] flex justify-center items-center mb-6">
                <p id="japanese-sentence" class="text-xl md:text-2xl font-medium text-center">「練習スタート！」を押してください</p>
            </div>

            <!-- 答え表示エリア -->
            <div id="answer-area" class="bg-blue-100 border-2 border-dashed border-blue-300 rounded-xl p-6 min-h-[100px] flex justify-center items-center mb-8 opacity-0 transition-opacity duration-300">
                <p id="english-sentence" class="text-lg md:text-xl font-bold text-blue-800 text-center"></p>
            </div>
        </main>

        <!-- フッターの操作ボタン -->
        <footer class="py-4">
            <button id="action-btn" class="btn w-full bg-blue-500 text-white font-bold py-4 rounded-lg shadow-md hover:bg-blue-600 transition-all focus:ring-blue-400 hidden">
                答えを見る
            </button>
             <button id="start-btn" class="btn w-full mt-4 bg-green-600 text-white font-bold py-4 rounded-lg shadow-lg hover:bg-green-700 transition-all focus:ring-green-400">
                練習スタート！
            </button>
        </footer>
    </div>

    <script>
        // サービスワーカーの登録
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js').then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }).catch(error => {
                    console.log('ServiceWorker registration failed: ', error);
                });
            });
        }
    </script>
    
    <!-- 最初にデータベースを読み込む -->
    <script src="database.js"></script>
    
    <!-- アプリ本体のロジック -->
    <script>
        // --- DOM要素の取得 ---
        const japaneseSentenceEl = document.getElementById('japanese-sentence');
        const englishSentenceEl = document.getElementById('english-sentence');
        const answerAreaEl = document.getElementById('answer-area');
        const actionBtn = document.getElementById('action-btn');
        const startBtn = document.getElementById('start-btn');

        // --- アプリの状態管理 ---
        let questionList = [];
        let currentQuestionIndex = 0;
        let isAnswerShown = false;

        // --- イベントリスナー ---
        startBtn.addEventListener('click', startPractice);
        actionBtn.addEventListener('click', handleAction);

        /**
         * 練習を開始する
         */
        function startPractice() {
            // データベースからランダムに20問選ぶ（重複ありでシンプルに）
            questionList = [];
            for (let i = 0; i < 20; i++) {
                const randomIndex = Math.floor(Math.random() * sentenceDatabase.length);
                questionList.push(sentenceDatabase[randomIndex]);
            }
            
            currentQuestionIndex = 0;
            displayQuestion();

            // UIの更新
            startBtn.classList.add('hidden');
            actionBtn.classList.remove('hidden');
        }

        /**
         * 現在の問題を画面に表示する
         */
        function displayQuestion() {
            if (currentQuestionIndex >= questionList.length) {
                finishPractice();
                return;
            }
            const question = questionList[currentQuestionIndex];
            japaneseSentenceEl.textContent = question.jp;
            englishSentenceEl.textContent = question.en;
            
            // 答えを隠してボタンをリセット
            isAnswerShown = false;
            answerAreaEl.classList.add('opacity-0');
            actionBtn.textContent = '答えを見る';
            actionBtn.classList.replace('bg-gray-700', 'bg-blue-500');
            actionBtn.classList.replace('hover:bg-gray-800', 'hover:bg-blue-600');
        }

        /**
         * メインボタンの操作を処理する
         */
        function handleAction() {
            if (!isAnswerShown) {
                // 答えを表示する
                answerAreaEl.classList.remove('opacity-0');
                isAnswerShown = true;
                actionBtn.textContent = '次の問題へ';
                actionBtn.classList.replace('bg-blue-500', 'bg-gray-700');
                actionBtn.classList.replace('hover:bg-blue-600', 'hover:bg-gray-800');
            } else {
                // 次の問題へ進む
                currentQuestionIndex++;
                displayQuestion();
            }
        }
        
        /**
         * 練習を終了する
         */
        function finishPractice() {
            japaneseSentenceEl.textContent = "練習お疲れ様でした！";
            actionBtn.classList.add('hidden');
            startBtn.textContent = "もう一度挑戦する";
            startBtn.classList.remove('hidden');
        }
    </script>
</body>
</html>
